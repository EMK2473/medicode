<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>MediCode</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      :root {
        --bg: #0f172a;
        --card: #111827;
        --muted: #94a3b8;
        --text: #e5e7eb;
        --accent: #60a5fa;
        --ok: #22c55e;
        --warn: #f59e0b;
        --bad: #ef4444;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
        background: var(--bg);
        color: var(--text);
      }
      .container { max-width: 1100px; margin: 2rem auto; padding: 0 1rem; }
      h1 { font-size: 1.5rem; margin: 0 0 1rem; }
      .card {
        background: var(--card);
        border: 1px solid #1f2937;
        border-radius: 14px;
        padding: 1rem;
        box-shadow: 0 8px 24px #00000040;
      }
      .row { display: grid; gap: 1rem; }
      @media (min-width: 900px) { .row { grid-template-columns: 2fr 1fr; } }

      textarea, input, button {
        width: 100%;
        border-radius: 10px;
        border: 1px solid #334155;
        background: #0b1220;
        color: var(--text);
        padding: 0.75rem 0.9rem;
        font-size: 0.95rem;
      }
      input { height: auto; }
      button {
        background: linear-gradient(90deg, #2563eb, #38bdf8);
        border: none;
        cursor: pointer;
        font-weight: 600;
        width:auto;
      }
      button.secondary { background: transparent; border: 1px solid #334155; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }

      .muted { color: var(--muted); font-size: 0.9rem; }
      
      .grid { display: grid; gap: 0.5rem; }
      .list-inline { display: flex; flex-wrap: wrap; gap: 0.4rem; }
      .pill {
        display: inline-flex; align-items: center; gap: 0.4rem;
        background: #0b1220; border: 1px solid #334155; border-radius: 999px;
        padding: 0.2rem 0.6rem; font-size: 0.85rem;
      }
      .pill .x { cursor: pointer; font-weight: 700; }

      .ok { color: --ok; }
      .bad { color: --bad; }
      .warn { color: --warn; }

      .pairs { margin-top: 1rem; border-top: 1px dashed #334155; padding-top: 1rem; }
      details { background: #0b1220; border: 1px solid #334155; border-radius: 10px; padding: 0.6rem 0.8rem; }
      summary { cursor: pointer; color: var(--accent); }
      .kvs { display: grid; grid-template-columns: 160px 1fr; gap: 0.35rem 0.75rem; font-size: 0.92rem; }
      .small { font-size: 0.85rem; }
      .footer { margin-top: 1rem; font-size: 0.85rem; color: var(--muted); }
      .table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
      .table th, .table td { border-bottom: 1px solid #1f2937; padding: 0.5rem 0.4rem; text-align: left; }
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }

      .flex { display: flex; align-items: center; justify-content: space-between; }
      .gap-sm { display: flex; gap: 0.4rem; }
      .gap-sm button { width: auto; } 
      .danger { background: #ef4444; border-color: #ef4444; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>
        Drug Interaction MVP <span class="muted">• RxNorm + openFDA</span>
      </h1>

      <div class="row">
        <div class="stack">
          <!-- User Input Field -->
          <div class="card stack">
            <label for="drugs"><strong>Enter your drugs</strong>
              <span class="muted">(one per line or separated by commas)</span>
            </label>
            <textarea
              id="drugs"
              rows="8"
              placeholder="e.g.
Advil 200 mg
ibuprofen
warfarin
Coumadin
atorvastatin
Lipitor"
            ></textarea>

            <div class="grid" style="grid-template-columns: 1fr auto">
              <div id="status" class="muted small">Idle.</div>
              <button id="analyze">Analyze</button>
            </div>
          </div>

          <div class="card stack" id="section-dedup" style="display: none">
            <h3>Deduped Ingredients</h3>
            <div id="dedupList" class="list-inline"></div>
            <div class="footer">
              Brands/generics are represented by ingredients.
              <span class="mono">(TTY=IN)</span>.
            </div>
          </div>

          <div class="card" id="section-pairs" style="display: none">
            <div class="flex">
              <h3 style="margin: 0">Unique Ingredient Pairs</h3>
              <button id="btnSaveMedList" disabled title="Save current searches to My Med List">
                Save Med List
              </button>
            </div>
            <table class="table" id="pairsTable" style="margin-top: 0.6rem">
              <thead>
                <tr>
                  <th>Ingredient A</th>
                  <th>Ingredient B</th>
                  <th>A mentions B</th>
                  <th>B mentions A</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <div class="footer">Not clinical advice.</div>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="stack">
          <!-- My Med List panel (matches original) -->
          <div class="card" id="section-medlist" style="margin-bottom: 1rem">
            <div class="flex">
              <h3 style="margin: 0">My Med List</h3>
              <div class="gap-sm">
                <button id="btnLoadMedList" disabled>Load My Med List</button>
                <button id="btnClearMedList" class="danger">Delete Med List</button>
              </div>
            </div>
            <div id="medListContainer" style="margin-top: 0.75rem"></div>
          </div>

          <!-- Debug -->
          <div class="card stack" style="margin-bottom: 1rem">
            <h3>Debug</h3>
            <details open>
              <summary>Normalized entries</summary>
              <pre id="debugNormalized" class="mono small" style="white-space: pre-wrap"></pre>
            </details>
            <details>
              <summary>First-pair label snippets</summary>
              <pre id="debugSnippets" class="mono small" style="white-space: pre-wrap"></pre>
            </details>
          </div>

          <div class="card footer">
            <strong>Disclaimer:</strong> This MVP parses FDA label text (“Drug Interactions”) and does a text match.
            It is not a curated interaction engine and is for research/education only. Consult a professional for medical guidance.
          </div>
        </div>
      </div>
    </div>

    <!-- Test Script -->
    <script type="module" src="./modules/test/indexTest.js"></script>
    <!-- Main Script (enable when moving past test) -->
    <!-- <script type="module" src="./modules/main.js"></script> -->
  </body>
</html>
